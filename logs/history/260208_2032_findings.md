# Technical Finding / Milestone

**Context**: Implementación del sistema de seguimiento de tareas CALAIRE-EA

## The Discovery

Se implementó exitosamente un sistema automatizado para extraer, exportar y hacer seguimiento de tareas del grafo Logseq mediante CSV, Python y Google Sheets. El sistema resuelve el problema de tareas con deadlines que pasan desapercibidas.

## Key Files Affected

- `tareas_calaire.csv` - CSV con 28 tareas del grafo (13 con deadline)
- `tools/export_tareas.py` - Script Python reutilizable para extracción de tareas
- `tools/alertas_tareas.gs` - Google Apps Script para alertas automáticas por email
- `tools/README_SEGUIMIENTO.md` - Documentación completa del sistema
- `logs/plans/260208_1952_plan_seguimiento-tareas-csv.md` - Plan de implementación

## How It Works

### 1. Extracción Automática con Python

El script `tools/export_tareas.py`:
- Lee todos los archivos `.md` en `pages/` y `journals/`
- Detecta bloques TODO/DOING/DONE con sus propiedades
- Extrae: deadline, priority, project, status, notas
- Genera CSV ordenado cronológicamente por deadline
- Uso: `python tools/export_tareas.py`

### 2. Formato del CSV

Columnas:
- `id` - Identificador único (APP-01, PI-02, etc.)
- `tarea` - Descripción de la tarea
- `deadline` - Fecha límite (YYYY-MM-DD) o vacío
- `prioridad` - high, medium, low o vacío
- `proyecto` - Proyecto asociado (CALAIRE-APP, CALAIRE-EA)
- `fuente` - Archivo de origen en Logseq
- `estado` - todo, doing, done
- `notas` - Notas adicionales

### 3. Detección de Bloques Logseq

El script soporta:
- Bloques con y sin indentación (tabuladores)
- Sintaxis: `- TODO`, `- DOING`, `- DONE`
- Propiedades en sub-líneas: `deadline::`, `priority::`, `project::`, `status::`

Ejemplo detectado:
```markdown
- TODO Enviar informe de hallazgos a César Yate
  project:: [[CALAIRE-APP]]
  priority:: high
  deadline:: 2026-02-15
```

### 4. Google Apps Script para Alertas

El script `tools/alertas_tareas.gs`:
- Envía alertas por email 3 días antes del deadline
- Colorea filas según urgencia:
  - Rojo = vencido
  - Amarillo = próximo (≤3 días)
  - Verde = completado
- Trigger automático diario a las 8am
- Funciones:
  - `enviarAlertas()` - Envía emails con tareas próximas
  - `formatoCondicional()` - Aplica colores
  - `configurarTrigger()` - Activa trigger diario
  - `testAlertas()` - Prueba manual
  - `estadisticas()` - Métricas de la hoja

### 5. Resultados de la Extracción

- **Total tareas encontradas**: 28
- **Con deadline**: 13
- **Estado**: 22 TODOs, 1 DOING, 5 DONEs
- **Archivos con tareas**: 9 (6 de pages/, 3 de journals/)

Distribución por archivo:
- `pages/CALAIRE-APP.md`: 6 tareas
- `pages/QMS.md`: 6 tareas
- `pages/Prueba Piloto.md`: 8 tareas
- `journals/2026_01_30.md`: 3 tareas
- `journals/2026_02_02.md`: 4 tareas
- `journals/2026_01_28.md`: 1 tarea

## Challenges Overcome

### 1. Detección de Bloques con Indentación

**Problema:** Los bloques TODO en Logseq pueden estar indentados con tabuladores.

**Solución:** Regex `^(\t*)-\s*(TODO|DOING|DONE)\s+(.+?)` captura el nivel de indentación y procesa propiedades en sub-líneas con la misma indentación.

### 2. Extracción de Propiedades con Caracteres Especiales

**Problema:** Las tareas contienen caracteres especiales (tildes, comas, punto y coma) que rompen CSV.

**Solución:** El script escapa comas por punto y coma en campos de texto. El CSV usa formato: `id,tarea,deadline,prioridad,proyecto,fuente,estado,notas` con punto y coma como separador en campos de texto.

### 3. Rutas Relativas en Diferentes Directorios

**Problema:** El script usa `Path.cwd()` pero puede ejecutarse desde cualquier directorio.

**Solución:** El script usa `Path(__file__).parent.parent` para obtener siempre el directorio raíz del proyecto, independientemente del directorio de ejecución.

### 4. Identificación Automática de IDs

**Problema:** Generar IDs coherentes (APP-01, PI-02) automáticamente.

**Solución:** El script infiere el prefijo basándose en:
- Si project es CALAIRE-APP → `APP-XX`
- Si el archivo es journal → `J-XX`
- Si el archivo es Prueba Piloto → `PI-XX`
- Por defecto → `EA-XX`

## Integration with Logseq

### Journal Entries Format

Los journals deben seguir el estándar definido en `AGENTS.md`:

```markdown
# Registro del Día
  project:: [[CALAIRE-EA]]
- ## Gestión de Participantes Prueba Piloto
	- **Confirmación Laboratorio:** respuesta positiva
	  date:: 2026-02-05
	  category:: [[Prueba Piloto]]
	  status:: confirmed
```

### TODO Blocks in Pages

Las tareas en páginas permanentes deben usar propiedades:

```markdown
- TODO Enviar informe de hallazgos
  project:: [[CALAIRE-APP]]
  priority:: high
  deadline:: 2026-02-15
```

## User Actions Required

1. **Import CSV en Google Sheets:**
   - Crear hoja nueva "Tareas CALAIRE-EA"
   - Importar `tareas_calaire.csv`

2. **Configurar Apps Script:**
   - Extensiones > Apps Script
   - Copiar contenido de `tools/alertas_tareas.gs`
   - Cambiar `tu-email@ejemplo.com` (línea 15) por email real
   - Ejecutar `configurarTrigger()` para activar alertas

3. **Actualizar CSV recurrentemente:**
   ```bash
   python tools/export_tareas.py
   ```

4. **Subir CSV a Google Sheets:**
   - Importar o copiar/pegar el CSV actualizado

## Future Improvements

- [ ] Automatizar subida a Google Sheets (Google Drive API)
- [ ] Crear página en Logseq con query de tareas dinámicas
- [ ] Integrar con sistema de tags para categorización de tareas
- [ ] Agregar métricas de progreso por proyecto
